# Crush 项目文档

欢迎来到 Crush 项目文档中心！

## 📚 文档列表

### [工作流与数据流详解 (workflow.md)](./workflow.md)

**最全面的项目源码解析文档**，包含：

- ✅ **项目整体架构** - 完整的分层结构和模块划分
- ✅ **核心数据结构** - App、Config、Message、Session、Agent 等详解
- ✅ **完整数据流** - 用户输入到 AI 响应的全流程追踪
- ✅ **详细时序图** - 5 个 Mermaid 时序图展示核心流程
- ✅ **设计模式** - PubSub、工具系统、LSP 集成、并发控制
- ✅ **启动流程** - 从 main.go 到 TUI 的完整初始化
- ✅ **数据持久化** - SQLite + SQLC 类型安全实践
- ✅ **配置系统** - 多层配置加载与合并
- ✅ **学习建议** - 三阶段学习路径和调试技巧

**文档统计**：
- 📄 文件大小：57KB
- 📝 行数：1953 行
- 🕐 预计阅读时间：60-90 分钟

---

### [AI Agent 架构深度解析 (agent-architecture.md)](./agent-architecture.md)

**⭐ 专注于 AI Agent 的深度剖析文档**，包含：

- ✅ **Agent 架构概览** - Agent 在系统中的位置和核心职责
- ✅ **核心结构详解** - Agent 接口、实现结构、工具分层管理
- ✅ **初始化流程** - 详细的 6 步初始化过程和时序图
- ✅ **对话请求生命周期** - Run() 和 processGeneration() 完整流程
- ✅ **Agent 与 Provider 交互** - 流式处理、事件处理详解
- ✅ **工具系统集成** - 工具管理、执行流程、时序图
- ✅ **事件流转机制** - 事件发布订阅、完整流转过程
- ✅ **并发控制** - 请求队列、状态管理、取消机制
- ✅ **核心时序图** - 4 个详细的 Mermaid 时序图
  - 完整对话流程（含所有阶段）
  - Agent 启动时序
  - 工具调用循环
  - 并发请求处理
- ✅ **源码阅读指南** - 文件清单、阅读路线、调试技巧

**适合人群**：
- 🎯 准备阅读 Agent 源码的开发者
- 🎯 想要理解 AI Agent 设计的工程师
- 🎯 需要扩展 Agent 功能的贡献者
- 🎯 对工具调用机制感兴趣的开发者

**文档统计**：
- 📄 文件大小：82KB
- 📝 行数：2100+ 行
- 🕐 预计阅读时间：90-120 分钟

---

## 🚀 快速开始

### 推荐阅读顺序

#### 阶段 1：建立整体认知（第1天）

**先读：[workflow.md](./workflow.md)**
1. **快速浏览**（15分钟）
   - 阅读"项目整体架构"了解分层
   - 查看"核心数据结构"了解主要类型
   - 浏览时序图建立流程认知

2. **重点理解**（1-2小时）
   - 详细阅读"完整数据流详解"
   - 理解"启动流程"
   - 学习"关键设计模式"

#### 阶段 2：深入 Agent 核心（第2-3天）

**再读：[agent-architecture.md](./agent-architecture.md)**
1. **理解架构**（30分钟）
   - Agent 在系统中的位置
   - 核心结构和职责划分
   - 初始化流程

2. **掌握流程**（2-3小时）
   - 对话请求生命周期
   - Agent 与 Provider 交互
   - 工具系统集成
   - 并发控制机制

3. **研究时序图**（1小时）
   - 完整对话流程（7个阶段）
   - Agent 启动时序
   - 工具调用循环
   - 并发请求处理

#### 阶段 3：实践与扩展（1-2周）

1. **跟随源码阅读指南**
   - 按推荐路线阅读源码
   - 在关键位置打断点调试
   - 添加日志追踪执行

2. **实践操作**
   - 使用调试技巧排查问题
   - 尝试修改功能
   - 扩展工具或 Agent

## 📖 相关资源

- **项目主页**: [GitHub - charmbracelet/crush](https://github.com/charmbracelet/crush)
- **开发指南**: [CRUSH_DEVELOPER_GUIDE.md](../CRUSH_DEVELOPER_GUIDE.md)
- **用户指南**: [CRUSH.md](../CRUSH.md)

## 🤝 贡献

如果你发现文档有错误或者有改进建议，欢迎提交 PR！

## 📝 更新日志

- **2025-01-20**: 初始版本发布
  - ✅ 发布 `workflow.md` - 完整的工作流和数据流文档
  - ✅ 发布 `agent-architecture.md` - AI Agent 架构深度解析
  - ✅ 创建 `README.md` - 文档导航和学习指南

---

*Happy Learning! 🎉*
